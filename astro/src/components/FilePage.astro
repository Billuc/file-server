---
import { getFileType } from "@/utils/fileUtils";
import { nullPassword } from "@/utils/passwordUtils";
import FileContent from "./FileContent.astro";

interface Props {
  file: {
    id: string;
    name: string;
    password: string;
  };
}

const { file } = Astro.props;

const hasNoPassword = await nullPassword(file.password);
const fileType = getFileType(file.name);
---

<section class="file-header">
  <h2>{file.name}</h2>
  <span>(<i style="user-select: all">{file.id}</i>)</span>
  {
    !hasNoPassword && (
      <span class="password-protected">ðŸ”’ Password Protected</span>
    )
  }

  <div class="spacer"></div>

  <div class="file-buttons">
    {
      fileType === "text" && (
        <button id="copy-button" class="file-button">
          Copy
        </button>
      )
    }
    <a
      href={`./f/${file.id}?download=true&enc=${encodeURIComponent(
        file.password,
      )}`}
      class="file-button"
    >
      Download
    </a>
    <button id="share-button" class="file-button">Share</button>
  </div>
</section>

<FileContent file={file} fileType={fileType} />

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const copyButton = document.getElementById("copy-button")!;
    const shareButton = document.getElementById("share-button")!;
    const fileContent = document.getElementById("file-content")!;

    if (copyButton) {
      const copyContent = () => {
        navigator.clipboard.writeText(fileContent.textContent).then(() => {
          alert("Content copied to clipboard!");
        });
      };
      copyButton.addEventListener("click", copyContent);
    }

    const shareContent = () => {
      navigator.clipboard.writeText(window.location.href).then(() => {
        alert("URL copied to clipboard!");
      });
    };

    shareButton.addEventListener("click", shareContent);
  });
</script>
